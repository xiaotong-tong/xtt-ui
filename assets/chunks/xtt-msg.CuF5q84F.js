var ct=Object.defineProperty;var ot=Object.getPrototypeOf;var lt=Reflect.get;var ut=(e,t,r)=>t in e?ct(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var b=(e,t,r)=>(ut(e,typeof t!="symbol"?t+"":t,r),r),z=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)};var p=(e,t,r)=>(z(e,t,"read from private field"),r?r.call(e):t.get(e)),y=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},K=(e,t,r,n)=>(z(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r);var w=(e,t,r)=>(z(e,t,"access private method"),r),Q=(e,t,r)=>lt(ot(e),r,t);import{x as ft}from"./reflect.u-rLhaQE.js";import{t as ht}from"./index.esm.AN5-tQ0m.js";import"./base.C5bbslE4.js";var gt=`<div id="body" part="body" class="msg-body"></div>
`;const U=new CSSStyleSheet;U.replaceSync(":host {display:flex;font-size:14px;width:100%;}#left {width:calc((100% - 100px) / 5 * 3);}#right {width:calc((100% - 100px) / 5 * 2);border:thin solid silver;padding:4px 8px;}#right .heimu {background-color:currentColor;}#right .heimu:hover {background-color:transparent;}#center {width:100px;display:flex;align-content:center;justify-content:center;flex-wrap:wrap;color:#4fc1ff;}:host ::highlight(xtt-highlight) {color:#ce9178;}");var O,Z;const D=class D{static doTextMatchList(t,r){var s;const n=t.match(new RegExp("(?<=-->>|\\()[\\s\\S]*?(?=-->>|\\)$)","g"));if(!n)return[];const a=w(s=D,O,Z).call(s,n,"-->>","\\(","\\)").map(i=>i.trim());return r?a:Promise.all(a.map(h.doReplaceToText))}};O=new WeakSet,Z=function(t,r,n,a){let s=[],i=0,c=[];return t.forEach(o=>{~o.search(new RegExp(n+"|"+a))?(i=i+(o.match(new RegExp(n,"g"))||[]).length-(o.match(new RegExp(a,"g"))||[]).length,c.push(o),i===0&&(s.push(c.join(r)),c=[])):i?c.push(o):s.push(o)}),s},y(D,O);let l=D;const L=(e,t)=>{if(e=Number(e),Number.isNaN(e))return t!=null&&t.NaNFormat?0:NaN;if(e>Number.MAX_SAFE_INTEGER)return Number.MAX_SAFE_INTEGER;if(e<Number.MIN_SAFE_INTEGER)return Number.MIN_SAFE_INTEGER;if(t!=null&&t.int)switch(t.intFormatType){case"ceil":e=Math.ceil(e);break;case"floor":e=Math.floor(e);break;case"round":e=Math.round(e);break;default:e=Math.trunc(e);break}return e},W=(e,t)=>{if(e>t){const r=e;e=t,t=r}return e=L(e,{NaNFormat:!0,int:!0,intFormatType:"ceil"}),t=L(t,{NaNFormat:!0,int:!0,intFormatType:"floor"}),[e,t]},V=(e,t)=>(e===void 0&&t===void 0&&(e=1,t=100),t===void 0&&(t=e,e=1),isNaN(e)||isNaN(t)?NaN:([e,t]=W(e,t),e+Math.floor(Math.random()*(t-e+1)))),pt=e=>{if(!(e!=null&&e.length))return[];const t=[...e];for(let r=t.length-1;r>0;r--){const n=V(0,r),a=t[n];t[n]=t[r],t[r]=a}return t},dt=(e,t,r)=>{if(e===void 0&&(e=0),t===void 0&&(t=e,e=0),r===0)return[];if(e=L(e,{NaNFormat:!0,int:!0,intFormatType:"ceil"}),t=L(t,{NaNFormat:!0,int:!0,intFormatType:"floor"}),e===t)return[e];r===void 0&&(r=t<e?-1:1),r=L(r,{NaNFormat:!0,int:!0,intFormatType:"trunc"});const n=~~((t-e)/r)+1,a=new Array(n);for(let s=0;s<n;s++)a[s]=s*r+e;return a},_=(e,t,r)=>{if(typeof t!="function"){console.error(t+" is not a function");return}const{thisArg:n,asyncIterator:a}=r||{};let s=!1;const i=o=>{if(o[Symbol.iterator]||o[Symbol.asyncIterator]){s=!0;let u=0;if(a||o[Symbol.asyncIterator])return new Promise((g,k)=>{(async()=>{const j=[];for await(const P of o)j.push(new Promise(it=>{it(t.call(n,P,u,o))})),u++;Promise.all(j).then(P=>{g(P)}).catch(P=>{k(P)})})()});{const g=[];for(const k of o){const j=t.call(n,k,u,o);u++,g.push(j)}return g}}};let c=i(e);return s||e instanceof Object&&(c=i(Object.entries(e))),c},v=(e,t,r)=>{if((typeof t>"u"||Number.isNaN(Number(t)))&&(t=10),e=L(e,{NaNFormat:!0}),r===void 0&&(r=!0),r){const n=t===16?"0x":t===8?"0o":t===2?"0b":"";return e>=0?n+e.toString(t):"-"+n+Math.abs(e).toString(t)}return e.toString(t)},yt=(...e)=>e!=null&&e.length?e.flat(1/0).reduce((t,r)=>t+r):0,tt=(e,t,r)=>{if(e===void 0&&(e=1),t===void 0&&(t=10),[e,t]=W(e,t),e===t)return[t];let n;if(typeof r=="number"?n=r:typeof r=="object"?n=r.count??t-e+1:n=t-e+1,n<=0)return[];if((r==null?void 0:r.unique)??!1)if(n>(t-e)/2){let s=dt(e,t);return s=pt(s),n===void 0?s:s.slice(0,n)}else{const s=new Set;for(;s.size<n;)s.add(V(e,t));return Array.from(s)}else{const s=[];for(let i=0;i<n;i++)s.push(V(e,t));return s}};function Tt(e,t){!Array.isArray(e)&&e instanceof Object&&(t=Object.values(e),e=Object.keys(e));let r=0;if(Array.isArray(e)&&Array.isArray(t)){t.length>e.length?t.length=e.length:e.length=t.length;const n=V(1,yt(t));for(let a=0;a<e.length;a++)if(r+=t[a],n<=r)return e[a]}return e[0]}const wt=e=>{if(!(e!=null&&e.length))return"";let t="";for(let r=e.length-1;r>=0;r--)t+=e[r];return t},Nt=e=>{if(e===void 0||e===""||Number.isNaN(e))return NaN;if(!Number.isNaN(Number(e)))return Number(e);if(!~e.search(/\d/))return NaN;const t=a=>a.replace(/\D/g,"");let r=1;e.startsWith("-")&&(r=-1);const n=e.indexOf(".");return~n?r*parseFloat(`${t(e.slice(0,n))}.${t(e.slice(n+1))}`):r*parseInt(t(e))},J=(e,t)=>{if(!e)return"";const{separator:r="",base:n=16}=t||{};return _(e,a=>v(a.codePointAt(0),n)).join(r)},bt=(e,t,r)=>{if(typeof e!="string")return!1;if(typeof t=="string")return e.startsWith(t,r);if(t instanceof RegExp){const n=e.slice(r);return t.source.startsWith("^")?t.test(n):new RegExp("^"+t.source,t.flags).test(n)}return!1},xt=(e,t,r)=>{if(typeof e!="string")return!1;if(typeof t=="string")return e.endsWith(t,r);if(t instanceof RegExp){const n=e.slice(0,r);return t.source.endsWith("$")?t.test(n):new RegExp(t.source+"$",t.flags).test(n)}return!1},mt=(e,t,r)=>{if(typeof e!="string"||t===void 0||(r===void 0&&(r=1),r===0))return"";if(bt(e,t)){if(r<=1)return"";r-=1}const n=new RegExp(`.+?(?=${typeof t=="string"?t:t.source})`,"g"),a=e.match(n);return a===null?"":(r<=-a.length&&(r=a.length===1?1:-a.length+1),a.slice(0,r).join(""))},St=(e,t,r)=>{if(typeof e!="string"||t===void 0)return"";if(r===void 0&&(r=1),r===0)return e;const n=typeof t=="string"?t:t.source,a=new RegExp(`(?<=(^|${n})).*?(${n}|$)`,"g"),s=e.match(a);return s===null?"":(r>=s.length&&(r=s.length-1),r<=-s.length&&(r=-s.length+1),s.slice(r).join(""))},Mt=(e,t)=>{if(typeof e!="string"||t===void 0)return"";const r=t[0],n=t[1],a=typeof r=="string"?r:r.source,s=typeof n=="string"?n:n.source;let i=e.match(new RegExp(`${a}((?:[\\s\\S](?<!${a}))*?)${s}`));return i?i[1]:(i=e.match(new RegExp(`${s}((?:[\\s\\S](?<!${s}))*?)${a}`)),i?i[1]:"")},x=new Map;x.set(["文本-反转文本","text-reverse"],async e=>{const[t]=await l.doTextMatchList(e);return t?wt(t):""});x.set(["文本-取文本左","text-getLeft"],async e=>{const[t,r,n]=await l.doTextMatchList(e);return t?r?mt(t,r,n):t:""});x.set(["文本-取文本右","text-getRight"],async e=>{const[t,r,n]=await l.doTextMatchList(e);return t?r?St(t,r,n):t:""});x.set(["文本-取中间","text-getContent"],async e=>{const[t,r,n]=await l.doTextMatchList(e);return t?Mt(t,[r,n]):""});x.set(["文本-替换","text-replace"],async e=>{let[t,r,n]=await l.doTextMatchList(e);return t?!r||!n?t:(r=r.split(/[,，]/),n=n.split(/[,，]/),t.replaceAll(new RegExp(r.map(a=>"("+a+")").join("|"),"g"),(a,...s)=>n[s.findIndex(i=>i!==void 0)]||"")):""});x.set(["文本-取数字","text-getNumber"],async e=>{const[t]=await l.doTextMatchList(e);if(!t)return"";const r=Nt(t);return Number.isNaN(r)?"":r});class T{static getVariable(t){let r=this.variableMap[t];if(r===void 0)throw"没有变量"+t+"哦";if(r.next){let n=r.next();return n.done?"已经获取完了哦~再重新赋值一个吧！":n.value}return r}static setVariable(t,r){return this.variableMap[t]=r,""}}b(T,"variableMap",{nyaLang:"nya,喵,~,!,‍,ニャー,にゃ,‎"});const m=new Map;function Lt(e=Date.now(),t){const r=new Date(e),n=r.getFullYear(),a=(r.getMonth()+1).toString().padStart(2,"0"),s=r.getDate().toString().padStart(2,"0"),i=r.getHours().toString().padStart(2,"0"),c=r.getMinutes().toString().padStart(2,"0"),o=r.getSeconds().toString().padStart(2,"0"),u=r.getDay(),g=["星期日","星期一","星期二","星期三","星期四","星期五","星期六"];return t?t==="all"?`${n}-${a}-${s} ${i}:${c}:${o} ${g[u]}`:t.replace(/=(?:[年月日时分秒]|星期)=/g,k=>{switch(k){case"=年=":return n;case"=月=":return a;case"=日=":return s;case"=时=":return i;case"=分=":return c;case"=秒=":return o;case"=星期=":return g[u]}}):`${n}-${a}-${s} ${i}:${c}:${o}`}m.set(["当前时间","now"],async e=>{const[t]=await l.doTextMatchList(e);return Lt(Date.now(),t)});m.set(["返回","return"],async e=>{let[t,r]=await l.doTextMatchList(e);return t&&(r==="0"?h.backText=t:(h.backTextPrevLevel.value=t,h.backTextPrevLevel.isCurrentLevel=!1)),""});m.set(["变量","variable"],async e=>{const[t,r]=await l.doTextMatchList(e);return t?r?T.setVariable(t,r):T.getVariable(t):""});m.set(["JSON"],async e=>{const[t,r]=await l.doTextMatchList(e);if(!t)return"";let a=JSON.parse(t);for(const s of r.matchAll(new RegExp("(?<=\\[)[\\s\\S]+?(?=\\])","g"))){if(a===void 0)return"";a=a==null?void 0:a[Array.isArray(s)?s[0]:s]}return Array.isArray(a)||a instanceof Object?JSON.stringify(a):a});m.set(["循环","forin"],async e=>{const[t,r,n]=await l.doTextMatchList(e,!0);if(!t)return"";const[a,s]=await Promise.all([h.doReplaceToText(t),h.doReplaceToText(r)]),i=a.split(new RegExp(s));let c=1;for(const o of i)T.setVariable("循环变量值",o),T.setVariable("循环变量次数",c),await h.doReplaceToText(n),c++;return""});m.set(["循环变量","forVariable"],async e=>{const[t]=await l.doTextMatchList(e);return t?t==="值"?T.getVariable("循环变量值"):t==="次数"?T.getVariable("循环变量次数"):"":""});const d=new Map;d.set(["选择","choice"],async e=>{let[t,...r]=await l.doTextMatchList(e,!0);if(!t)return"";if(t=await h.doReplaceToText(t),isNaN(+t)){let n="?<"+t+">",a="";for await(const s of r){const i=await h.doReplaceToText(s);i.startsWith(n)&&(a=i)}return a?a.substring(n.length):""}else{let n=parseInt(t);if(n>0)n=n-1,n>=r.length&&(n=r.length-1);else{if(n===0)return"";n<0&&(n=n+r.length,n<0&&(n=0))}return h.doReplaceToText(r[n])}});d.set(["判断","judge","if"],async e=>{const[t,r="",n=""]=await l.doTextMatchList(e,!0);if(!t)return"";const a=await h.doReplaceToText(t);try{return Function("return "+a)()?h.doReplaceToText(r):h.doReplaceToText(n)}catch{throw`请将${e}改为正确的判断公式`}});d.set(["计算","calc"],async e=>{const[t]=await l.doTextMatchList(e);if(!t)return"";try{return Function("return "+t)()}catch{throw`请将${e}改为正确的计算公式`}});d.set(["随机数","random","r"],async e=>{let[t,r,n]=await l.doTextMatchList(e);return n=parseInt(n),isNaN(n)&&(n=1),tt(t||1,r||100,n).join(",")});d.set(["权重随机数","weidgeRandom","WR"],async e=>{const[t,r]=await l.doTextMatchList(e);if(!t)return"";const n=t.split(/[,，]/);let a=[];if(r)a=r.split(/[,，]/).map(s=>parseInt(s));else for(let s=0;s<n.length-1;s++)a.push(1);return Tt(n,a)});d.set(["非重随机数"],async e=>{const[t,r,n]=await l.doTextMatchList(e),a=tt(t||1,r||10,{unique:!0});return n?(T.setVariable(n,a[Symbol.iterator]()),""):a});d.set(["八进制"],async e=>{const[t]=await l.doTextMatchList(e)||[];if(!t)return"";const r=Number(t);return Number.isNaN(r)?J(t,{base:8}):v(r,8)});d.set(["十六进制"],async e=>{const[t]=await l.doTextMatchList(e)||[];if(!t)return"";const r=Number(t);return Number.isNaN(r)?J(t,{base:16}):v(r,16)});d.set(["二进制"],async e=>{const[t]=await l.doTextMatchList(e)||[];if(!t)return"";const r=Number(t);return Number.isNaN(r)?J(t,{base:2}):v(r,2)});d.set(["十进制"],async e=>{const[t]=await l.doTextMatchList(e)||[];if(!t)return"";const r=Number(t);return Number.isNaN(r)?J(t,{base:10}):v(r,10)});const A=new Map;function et(e){return/^<[\s\S]+>$/.test(e)}A.set(["文本-注音","text-ruby"],async e=>{const[t,r]=await l.doTextMatchList(e);return!t&&!r?"":`<ruby>${t}<rp>(</rp><rt>${r}</rt><rp>)</rp></ruby>`});function $t(e,t){return et(e)?t?(e=e.replaceAll("'",'"'),e.includes("style=")?e.replace(/style="([\s\S]*?)"(?![;,])/,`style="$1 color: ${t};"`):e.replace(/^<([^>]+?)>/,`<$1 style="color: ${t};">`)):e:t?`<span style="color: ${t};" >${e}</span>`:`<span>${e}</span>`}A.set(["文本-文字颜色","text-color"],async e=>{const[t,r]=await l.doTextMatchList(e);return t?$t(t,r):""});function Et(e){return et(e)?(e=e.replaceAll("'",'"'),e.includes("class=")?e.replace(/class="([^"]*?)"/,'class="$1 heimu"'):e.replace(/^<([^>]+?)>/,'<$1 class="heimu">')):`<span class="heimu">${e}</span>`}A.set(["文本-黑幕","text-mask"],async e=>{const[t]=await l.doTextMatchList(e);return t?Et(t):""});A.set(["换行","break"],()=>"<br />");A.set(["空格","space"],()=>"&nbsp;");const Y=new Map;Y.set(["喵语"],async e=>{const[t]=await l.doTextMatchList(e);if(!t)return"";const r=T.getVariable("nyaLang").split(",");return _(t,n=>v(n.codePointAt(0),8,!1).replace(/\d/g,a=>r[a])).join("‌")+"."});Y.set(["解喵语"],async e=>{let[t]=await l.doTextMatchList(e);if(!t)return"";const r=T.getVariable("nyaLang").split(",");if(t=t.substring(0,t.length-1),!new RegExp(`^(${r.join("|")}|‌)+$`).test(t))throw"遇到了不认识的喵语呢。";return t.split("‌").map(a=>String.fromCodePoint("0o"+a.replace(new RegExp(r.join("|"),"g"),s=>r.indexOf(s)))).join("")});const C={};A.forEach((e,t)=>{t.forEach(r=>{C[r]=e})});Y.forEach((e,t)=>{t.forEach(r=>{C[r]=e})});d.forEach((e,t)=>{t.forEach(r=>{C[r]=e})});m.forEach((e,t)=>{t.forEach(r=>{C[r]=e})});x.forEach((e,t)=>{t.forEach(r=>{C[r]=e})});var G,rt;const f=class f{static doReplace(t){return f.doReplaceToText(t)}static formatToParts(t){return f.getParts(t).formatParts}static async replaceAsync(t,r,n){const a=[];t.replace(r,(i,...c)=>{const o=n(i,...c);a.push(o)});const s=await Promise.all(a);return t.replace(r,()=>s.shift())}static getParts(t,r=!1){let n=t.match(/[()]|[^()]+/g),a=[],s=[],i=0,c=0,o=0;for(let u=1;u<n.length;u++)if(n[u]==="("){const g=xt(n[u-1],/!\[[^\]]+\]$/);if(i===0&&!g)continue;i===0&&(c=u),i++}else if(n[u]===")"){if(i<=0)continue;if(i===1){const g=(n[c-1].match(/!\[[^\]]+\]$/)[0]??"")+n.slice(c,u+1).join("");s.push(g),n[c-1]=n[c-1].replace(/!\[[^\]]+\]$/,""),a.push(n.slice(o,c).join("")),a.push(g),o=u+1}i--}return o<n.length&&a.push(n.slice(o,n.length).join("")),a=a.filter(u=>u!=="").map(u=>u.startsWith("![")&&u.endsWith(")")&&/.+!\[[^\]]+\]\([\s\S]*\)/.test(u)?{value:u,children:f.getParts(u.replace(/.+?\(|\)$/,""),!0)}:u),r?a:{matches:s,formatParts:a}}static async doReplaceToText(t){if(/!\[[^\]]+\]\([\s\S]*\)/.test(t)){const{matches:r}=f.getParts(t);for(const n of r){const a=async s=>{var c;const i=await w(c=f,G,rt).call(c,s);if(f.backTextPrevLevel.isCurrentLevel===!0){const o=f.backTextPrevLevel.value;return f.backTextPrevLevel={},o}else f.backTextPrevLevel.isCurrentLevel===!1&&(f.backTextPrevLevel.isCurrentLevel=!0);return i};t=await f.replaceAsync(t,n,a),f.backText&&(t=f.backText,f.backText="")}}return t}};G=new WeakSet,rt=function(t){const r=t.match(/^!\[([^\]]+)\]/);return f.MatchTextList[r[1]]?f.MatchTextList[r[1]](r.input):r.input},y(f,G),b(f,"backText"),b(f,"backTextPrevLevel",{}),b(f,"MatchTextList",C);let h=f;const Rt=async e=>{try{return await h.doReplace(e)}catch(t){return t}},vt=e=>h.formatToParts(e);console.log(vt("1:(![随机数]())."));var $,E,F,R,I,q,nt,N,S,H,at,B,st;const M=class M extends ft{constructor(){super();y(this,E);y(this,R);y(this,q);y(this,N);y(this,H);y(this,B);y(this,$,[]);p(this,q,nt).addEventListener("click",()=>{w(this,R,I).call(this)});const r=ht(w(this,E,F).bind(this),500);p(this,N,S).addEventListener("input",r)}connectedCallback(){super.connectedCallback(),p(this,N,S).textContent=this.textContent,w(this,R,I).call(this),w(this,E,F).call(this)}_reflectElementAdded(){p(this,N,S).textContent=this.textContent,w(this,R,I).call(this),w(this,E,F).call(this)}};$=new WeakMap,E=new WeakSet,F=function(){if(!CSS.highlights)return;const r=p(this,N,S).childNodes,n=[];r.forEach(s=>{for(const i of s.nodeValue.matchAll(/!\[[^\]]+\]|-->>/g)){const c=new Range;c.setStart(s,i.index),c.setEnd(s,i.index+i[0].length),n.push(c)}});let a;CSS.highlights.has("xtt-highlight")?(a=CSS.highlights.get("xtt-highlight"),p(this,$).length&&p(this,$).forEach(s=>a.delete(s)),n.forEach(s=>a.add(s))):a=new Highlight(...n),CSS.highlights.set("xtt-highlight",a),K(this,$,n)},R=new WeakSet,I=async function(){const r=Date.now(),n=p(this,N,S).value;n&&(console.time(n),p(this,H,at).innerHTML=await Rt(n),console.timeEnd(n),p(this,B,st).textContent="用时: "+(Date.now()-r)+"ms")},q=new WeakSet,nt=function(){return this.shadowRoot.querySelector("#run")},N=new WeakSet,S=function(){return this.shadowRoot.querySelector("#left")},H=new WeakSet,at=function(){return this.shadowRoot.querySelector("#right")},B=new WeakSet,st=function(){return this.shadowRoot.querySelector("#time")},b(M,"templateContent",gt),b(M,"stylesContent",[...Q(M,M,"stylesContent"),U]);let X=M;customElements.define("xtt-msg",X);
